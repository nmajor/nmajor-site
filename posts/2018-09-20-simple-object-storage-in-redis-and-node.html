<!DOCTYPE html><html lang="en" class="h-full antialiased"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" imageSrcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=16&amp;q=75 16w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=32&amp;q=75 32w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=48&amp;q=75 48w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=64&amp;q=75 64w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=96&amp;q=75 96w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=128&amp;q=75 128w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=256&amp;q=75 256w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=384&amp;q=75 384w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=640&amp;q=75 640w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=750&amp;q=75 750w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=828&amp;q=75 828w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=3840&amp;q=75 3840w" imageSizes="2.25rem" fetchPriority="high"/><link rel="stylesheet" href="/_next/static/css/9d8f288a99c54fb3.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-113544170b8b14d7.js" crossorigin=""/><script src="/_next/static/chunks/de8a8aed-ff24f23ca546a20c.js" async="" crossorigin=""></script><script src="/_next/static/chunks/362-edde6a9467fb7f3f.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-dca2b37e6b098eb8.js" async="" crossorigin=""></script><script src="/_next/static/chunks/736-93d26bf9f492bada.js" async=""></script><script src="/_next/static/chunks/545-972397648c423446.js" async=""></script><script src="/_next/static/chunks/871-e93f475163439fcd.js" async=""></script><script src="/_next/static/chunks/app/layout-58152a9375fe786b.js" async=""></script><script src="/_next/static/chunks/app/posts/page-6d06c0c42f2ef9eb.js" async=""></script><title>Simple Object Storage in Redis (Node.js) - Spencer Sharp</title><meta name="description" content="I’m Spencer, a software designer and entrepreneur based in New York City. I’m the founder and CEO of Planetaria, where we develop technologies that empower regular people to explore space on their own terms."/><link rel="alternate" type="application/rss+xml" href="undefined/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="flex h-full"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex w-full"><div class="relative flex w-full flex-col"><header class="pointer-events-none relative z-50 flex flex-none flex-col" style="height:var(--header-height);margin-bottom:var(--header-mb)"><div class="top-0 z-10 h-16 pt-6" style="position:var(--header-position)"><div class="sm:px-8 top-[var(--header-top,theme(spacing.6))] w-full" style="position:var(--header-inner-position)"><div class="mx-auto w-full max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="relative flex gap-4"><div class="flex flex-1"><div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10"><a aria-label="Home" class="pointer-events-auto" href="/"><img alt="" fetchPriority="high" width="1000" height="1000" decoding="async" data-nimg="1" class="rounded-full bg-zinc-100 object-cover dark:bg-zinc-800 h-9 w-9" style="color:transparent" sizes="2.25rem" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=16&amp;q=75 16w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=32&amp;q=75 32w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=48&amp;q=75 48w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=64&amp;q=75 64w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=96&amp;q=75 96w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=128&amp;q=75 128w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=256&amp;q=75 256w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=384&amp;q=75 384w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=640&amp;q=75 640w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=750&amp;q=75 750w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=828&amp;q=75 828w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=3840&amp;q=75"/></a></div></div><div class="flex flex-1 justify-end md:justify-center"><nav class="pointer-events-auto hidden md:block"><ul class="flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10"><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/about">About</a></li><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/posts">Blog</a></li><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/projects">Projects</a></li></ul></nav></div><div class="flex justify-end md:flex-1"><div class="pointer-events-auto"><button class="inline-flex items-center justify-center text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground rounded-md h-8 w-8 px-0" type="button" id="radix-:R75la:" aria-haspopup="menu" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"><circle cx="12" cy="12" r="4"></circle><path d="M12 3v1"></path><path d="M12 20v1"></path><path d="M3 12h1"></path><path d="M20 12h1"></path><path d="m18.364 5.636-.707.707"></path><path d="m6.343 17.657-.707.707"></path><path d="m5.636 5.636.707.707"></path><path d="m17.657 17.657.707.707"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg><span class="sr-only">Toggle theme</span></button></div></div></div></div></div></div></div></div></header><main class="flex-auto"><div class="sm:px-8 post mt-16 lg:mt-32"><div class="mx-auto w-full max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="xl:relative"><div class="mx-auto max-w-2xl"><article><header class="flex flex-col"><h1 class="text-4xl font-bold font-bold tracking-tight sm:text-5xl">Simple Object Storage in Redis (Node.js)</h1><div class="flex gap-3 pt-1"><time dateTime="2018-10-05" class="text-muted-foreground order-first flex items-center pr-2 text-base"><span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span><span class="ml-3">October 5, 2018</span></time><span class="text-muted-foreground">-</span><span class="text-muted-foreground/80">node</span><span class="text-muted-foreground/80">redis</span><span class="text-muted-foreground/80">javascript</span></div><div class="text-accent-foreground pt-3 text-sm italic">~<!-- -->10 min read</div></header><div class="mt-8 prose dark:prose-invert" data-mdx-content="true"><div><p><strong>First</strong> it was important for our use case to have some basic kind of indexing and sorting based on when the document was created.</p>
<p><strong>Second</strong>, since we do a lot of logging, we needed to make sure that all documents clean up after themselves and expire nicely so we don't run out of space in redis, and we don't really care about keeping these logs indefinitely.</p>
<p><strong>Third</strong>, our logs are javascript objects, so we needed some kind of customizable serialization/deserialization.</p>
<p><strong>Fourth</strong>, I wanted to have a nice abstraction with predictable model-like behavior like <code>findOne</code>, <code>create</code>, <code>update</code>, and <code>fromIndex</code>.</p>
<p>So here is a basic solution I came up with.</p>
<p>The plan:</p>
<ul>
<li><strong>Schema</strong> - Add a schema for <code>redisModels</code></li>
<li><strong>Finding, Creating and Updating</strong> - Use <a href="">redis hashes</a> to store our objects and have functions for adding, finding, and updating.</li>
<li><strong>Indexing and Sorting</strong> - Use <a href="https://redis.io/topics/data-types#lists" title="https://redis.io/topics/data-types#lists">redis lists</a> (aka ranges) to maintain a sorted list of object keys.</li>
</ul>
<p>I'll be using the main <a href="https://www.npmjs.com/package/redis" title="https://www.npmjs.com/package/redis">redis node</a> library for this.</p>
<h3 id="schema"><a aria-hidden="true" tabindex="-1" href="#schema"><a href="#schema" style="margin-right: 10px">#</a></a>Schema</h3>
<p>Here is what our basic schema will look like:</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">logSchema</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">namespace</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">logs</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">indexes</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">[</span></span>
<span class="line"><span style="color: #ADD7FF">    </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">getName</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">()</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">createdAt</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">shouldIndex</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">()</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">addNonTenantIndex</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">()</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">getValue</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">new</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">createdAt</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">getTime</span><span style="color: #A6ACCD">(),</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #ADD7FF">  </span><span style="color: #A6ACCD">],</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">attributes</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">source</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">kind</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">string</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">user</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">kind</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">object</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">body</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">kind</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">object</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">createdAt</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">kind</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">time</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #A6ACCD">};</span></span></code></pre>
<p>As you can see we set information about our <code>attributes</code>, <code>indexes</code> and a <code>namespace</code> that we will use for our redis keys. The <code>namespace</code> is mostly useful if you plan on storing multiple kinds of objects in redis.</p>
<h3 id="creating"><a aria-hidden="true" tabindex="-1" href="#creating"><a href="#creating" style="margin-right: 10px">#</a></a>Creating</h3>
<p>We'll start by creating a new class and constructor inside of a new file called <code>lib/redis.js</code>. I know this is a bunch of code to dump in all at once, but I'll break it down afterwards:</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">shortid</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">shortid</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">_</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">lodash</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">getRedisClient</span><span style="color: #A6ACCD">() {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic">// IMPLEMENT YOUR OWN METHOD OF GETTING THE REDIS CLIENT,</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">expSeconds</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">days</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">30</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">secondsPerDay</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">86400</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">days</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">*</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">secondsPerDay</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">buildId</span><span style="color: #A6ACCD">() { </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">shortid</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">generate</span><span style="color: #A6ACCD">(); }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">stringify</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">string</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">number</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">toString</span><span style="color: #A6ACCD">(),</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">date</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">new</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">toISOString</span><span style="color: #A6ACCD">(),</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">time</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">new</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">toISOString</span><span style="color: #A6ACCD">(),</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">object</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> JSON</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">stringify</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">),</span></span>
<span class="line"><span style="color: #A6ACCD">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">export default </span><span style="color: #91B4D5">class</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">RedisModel</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #91B4D5">constructor</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">      schema</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">client</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FBD0">getRedisClient</span><span style="color: #A6ACCD">(),</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">};</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #ADD7FF">_buildHashValues</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> schema</span><span style="color: #A6ACCD">:</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">attributes</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">[];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #E4F0FB">_</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">each</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">value</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">key</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">type</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">attributes</span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">key</span><span style="color: #A6ACCD">]</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">||</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{}).</span><span style="color: #E4F0FB">kind</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">stringValue</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">stringify</span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">type</span><span style="color: #A6ACCD">]</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">?</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">stringify</span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">type</span><span style="color: #A6ACCD">](</span><span style="color: #E4F0FB">value</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">:</span><span style="color: #5DE4C7"> </span><span style="color: #D0679D">undefined</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">if</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #91B4D5">!</span><span style="color: #E4F0FB">type</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">||</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">!</span><span style="color: #E4F0FB">stringValue</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #D0679D">null</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">push</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">key</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">stringValue</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #A6ACCD">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">_</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">isEmpty</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">?</span><span style="color: #5DE4C7"> </span><span style="color: #D0679D">undefined</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">:</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #ADD7FF">_buildRedisKey</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">schema</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">namespace</span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7">:</span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">}`</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #ADD7FF">create</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">client</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> new </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">reject</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">multi</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">client</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">multi</span><span style="color: #A6ACCD">();</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">id</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">buildId</span><span style="color: #A6ACCD">();</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">redisKey</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildRedisKey</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic">// Handle the hash values</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildHashValues</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">if</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">hmset</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">hmset</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">EX</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">expSeconds</span><span style="color: #A6ACCD">());</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">exec</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">          </span><span style="color: #A6ACCD">if</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">reject</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">          </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">resolve</span><span style="color: #A6ACCD">({</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">key</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">_id</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">...</span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">else</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #E4F0FBD0">reject</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">new </span><span style="color: #E4F0FBD0">Error</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">Empty redis hash data</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">));</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>First of all you'll notice I'm using the <a href="">lodash</a> for its useful helper methods, and <a href="https://www.npmjs.com/package/shortid" title="https://www.npmjs.com/package/shortid">shortid</a> to help generate unique ids for our redis keys.</p>
<p>We are using the <code>multi</code> redis behavior.</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">client</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">multi</span><span style="color: #A6ACCD">();</span></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// ...</span></span>
<span class="line"><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">hmset</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">hmset</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">, </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">EX</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FBD0">expSeconds</span><span style="color: #A6ACCD">());</span></span>
<span class="line"><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">exec</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">) </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// ...</span></span></code></pre>
<p>This allows us to do multiple calls in one redis transaction, and if one of the calls fails, the whole transaction will fail. This reduces the chances that we'll have stray data being stored in the database.</p>
<p>We're also using our schema namespace to build a unique redis key for our object.</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildRedisKey</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">_buildRedisKey</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { </span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD"> } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">namespace</span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7">:</span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">}`</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">  }</span></span></code></pre>
<p>This isn't totally necessary, and really only useful if you are storing multiple types of objects in redis, but it does give us the ability to do basic fetching redis for all items with the namespace prefix later if we want.</p>
<p>You can see that we're using a <a href="https://redis.io/topics/data-types#hashes" title="https://redis.io/topics/data-types#hashes">redis hash</a> to store all our object data.</p>
<pre><code>multi.hmset(redisKey, hashValues);
</code></pre>
<p>The <a href="https://redis.io/commands/hmset" title="https://redis.io/commands/hmset">hmset</a> function takes an array of key value pairs. Redis hashes require the values to be strings, so our <code>_buildHashValues</code> function takes our data and converts it to an array of strings based on the key/value pairs and attribute types in the schema.</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #E4F0FBD0">_buildHashValues</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { schema: { </span><span style="color: #E4F0FB">attributes</span><span style="color: #A6ACCD"> } } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">_</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">each</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">, (</span><span style="color: #E4F0FB">value</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">key</span><span style="color: #A6ACCD">) </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">type</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> (</span><span style="color: #E4F0FB">attributes</span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">key</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">||</span><span style="color: #A6ACCD"> {}).</span><span style="color: #E4F0FB">kind</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">stringValue</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">stringify</span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">type</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">?</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">stringify</span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">type</span><span style="color: #A6ACCD">](</span><span style="color: #E4F0FB">value</span><span style="color: #A6ACCD">) </span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #D0679D">undefined</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">    if (</span><span style="color: #91B4D5">!</span><span style="color: #E4F0FB">type</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">||</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">!</span><span style="color: #E4F0FB">stringValue</span><span style="color: #A6ACCD">) </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #D0679D">null</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">push</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">key</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">stringValue</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #A6ACCD">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">_</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">isEmpty</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">) </span><span style="color: #91B4D5">?</span><span style="color: #A6ACCD"> </span><span style="color: #D0679D">undefined</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>And it uses our <code>stringify</code> object as a map for how to convert the different attributes to strings based on the schema. This gives us some granular control over the serialization of each attribute of our objects.</p>
<p>And we're also setting an expiration for our keys so they dont last forever in our database.</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">hmset</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">, </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">EX</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FBD0">expSeconds</span><span style="color: #A6ACCD">());</span></span></code></pre>
<p>And that handles our ability to create new objects in our redis model.</p>
<h3 id="updating"><a aria-hidden="true" tabindex="-1" href="#updating"><a href="#updating" style="margin-right: 10px">#</a></a>Updating</h3>
<p>Our update function is very similar to our create:</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">export default </span><span style="color: #91B4D5">class</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">RedisModel</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic">// ...</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #ADD7FF">update</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">client</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> new </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">reject</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">redisKey</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildRedisKey</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic">// Handle the hash values</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildHashValues</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">if</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #E4F0FB">client</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">hmset</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">          </span><span style="color: #A6ACCD">if</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">reject</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">          </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">resolve</span><span style="color: #A6ACCD">();</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">else</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">resolve</span><span style="color: #A6ACCD">();</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>Basically it uses the same <code>_buildRedisKey</code> function so we only have to deal with the id of the object. Then it basically just does the same <code>hmset</code> function. Redis will keep any attributes in the hash that are not overwritten.</p>
<h3 id="finding"><a aria-hidden="true" tabindex="-1" href="#finding"><a href="#finding" style="margin-right: 10px">#</a></a>Finding</h3>
<p>Here's our find method. This lets us find any object by id and deserialize all the values into their original datatypes based on the schema:</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">parsify</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">string</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">number</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FBD0">parseInt</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">,</span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">10</span><span style="color: #A6ACCD">),</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">date</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">new</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">),</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">time</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">new</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">),</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">object</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> JSON</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">parse</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">),</span></span>
<span class="line"><span style="color: #A6ACCD">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">export default </span><span style="color: #91B4D5">class</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">RedisModel</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic">// ...</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #ADD7FF">_unpackHashValues</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> schema</span><span style="color: #A6ACCD">:</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">attributes</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">obj</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #E4F0FB">_</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">each</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">value</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">key</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">type</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">attributes</span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">key</span><span style="color: #A6ACCD">]</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">||</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{}).</span><span style="color: #E4F0FB">kind</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">if</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #91B4D5">!</span><span style="color: #E4F0FB">type</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #D0679D">null</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #E4F0FB">obj</span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">key</span><span style="color: #A6ACCD">]</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">parsify</span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">type</span><span style="color: #A6ACCD">](</span><span style="color: #E4F0FB">value</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #D0679D">null</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #A6ACCD">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">_</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">isEmpty</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">obj</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">?</span><span style="color: #5DE4C7"> </span><span style="color: #D0679D">undefined</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">:</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">obj</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #ADD7FF">findOne</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">client</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> new </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">reject</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">redisKey</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildRedisKey</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #E4F0FB">client</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">hgetall</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #A6ACCD">if</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">reject</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">resolve</span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #ADD7FF">key</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #ADD7FF">_id</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5">...</span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_unpackHashValues</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">),</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>Here is where we use a <code>parsify</code> method to convert our attribute strings into their original data type.</p>
<p>And that handles our finding and deserialization.</p>
<h3 id="indexing-and-sorting"><a aria-hidden="true" tabindex="-1" href="#indexing-and-sorting"><a href="#indexing-and-sorting" style="margin-right: 10px">#</a></a>Indexing and Sorting</h3>
<p>Here is the tricky part. Redis, as a key/value store doesnt have any real sense of ordering when it comes to its keys. But its important for our use case to be able to see the most recent logs, and maybe later be able to query date ranges of when the logs were created.</p>
<p>So what we're going to do is use the redis function <code>zadd</code> to add the redis key and timestamp for each object into a sorted redis list.</p>
<p>Remember from our schema, indexes look like this:</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">getName</span><span style="color: #A6ACCD">: () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">createdAt</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">shouldIndex</span><span style="color: #A6ACCD">: () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">getValue</span><span style="color: #A6ACCD">: </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">new</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">createdAt</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">getTime</span><span style="color: #A6ACCD">(),</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p><code>getName</code> is a function because I've found it useful to be able to create some indexes that are isolated in different ways. For example I've sometimes added indexes that are based on the ID of the user who created the log, this lets me easily get a list of all the user's most recent indexes. And in that case the <code>getName</code> looks like this <code>getName: data => ('user:'+data.user._id+':createdAt')</code>.</p>
<p><code>shouldIndex</code> lets us not index any object we want, and <code>getValue</code> gives us the actual value of the index, so this actually lets us create sorted lists using any different attribute not just createdAt. Just remember that <code>getValue</code> has to return a number.</p>
<p>Now we modify our <code>create</code> function to include a <code>zadd</code> for each index in our schema:</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #E4F0FBD0">_buildIndexName</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">indexName</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { </span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD"> } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">namespace</span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7">:</span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">indexName</span><span style="color: #A6ACCD">}`</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #A6ACCD">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">create</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { </span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">client</span><span style="color: #A6ACCD"> } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">new</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">reject</span><span style="color: #A6ACCD">) </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">client</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">multi</span><span style="color: #A6ACCD">();</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">buildId</span><span style="color: #A6ACCD">();</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildRedisKey</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic">// Handle the hash values</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildHashValues</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #A6ACCD">      if (</span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">hmset</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">hashValues</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">hmset</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">, </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">EX</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FBD0">expSeconds</span><span style="color: #A6ACCD">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #767C9DB0; font-style: italic">// Handle indexes</span></span>
<span class="line"><span style="color: #A6ACCD">        if (</span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">indexes</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #E4F0FB">_</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">each</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">indexes</span><span style="color: #A6ACCD">, (</span><span style="color: #E4F0FB">index</span><span style="color: #A6ACCD">) </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">            if (</span><span style="color: #E4F0FB">index</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">shouldIndex</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">)) {</span></span>
<span class="line"><span style="color: #A6ACCD">              </span><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">zadd</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildIndexName</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">index</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">getName</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">)), </span><span style="color: #E4F0FB">index</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">getValue</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">), </span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #A6ACCD">            }</span></span>
<span class="line"><span style="color: #A6ACCD">          });</span></span>
<span class="line"><span style="color: #A6ACCD">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #E4F0FB">multi</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">exec</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">) </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">          if (</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">) </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">reject</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">resolve</span><span style="color: #A6ACCD">({</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">key</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">redisKey</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">_id</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">...</span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #A6ACCD">        });</span></span>
<span class="line"><span style="color: #A6ACCD">      } else {</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #E4F0FBD0">reject</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">new</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">Error</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">Empty redis hash data</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">));</span></span>
<span class="line"><span style="color: #A6ACCD">      }</span></span>
<span class="line"><span style="color: #A6ACCD">    });</span></span>
<span class="line"><span style="color: #A6ACCD">  }</span></span></code></pre>
<p>This inserts the <code>redisKey</code> of each object into a sorted list based on the createdAt timestamp of the object.</p>
<p>Now we can easily retrieve the top objects from any index with a function like this:</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">export default </span><span style="color: #91B4D5">class</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">RedisModel</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic">// ...</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #ADD7FF">_clearOldIndexes</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">indexName</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">client</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">schema</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> new </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">reject</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">now</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> new </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">().</span><span style="color: #E4F0FBD0">getTime</span><span style="color: #A6ACCD">();</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">secondsPerDay</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> 86400</span><span style="color: #A6ACCD">;</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">args</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">[</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_buildIndexName</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">indexName</span><span style="color: #A6ACCD">),</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">now</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">+</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FBD0">expSeconds</span><span style="color: #A6ACCD">()</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">-</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">secondsPerDay</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">*</span><span style="color: #5DE4C7"> 1000</span><span style="color: #A6ACCD">),</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">-inf</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #E4F0FB">client</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">zremrangebyscore</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">args</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">results</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #A6ACCD">if</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">reject</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">resolve</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">results</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #ADD7FF">_getIndexedIds</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">indexName</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">offset</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">limit</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">client</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">props</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_clearOldIndexes</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">indexName</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">then</span><span style="color: #A6ACCD">(()</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> new </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">reject</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">args</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">[</span><span style="color: #E4F0FB">indexName</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">+inf</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">-inf</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">LIMIT</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">offset</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">||</span><span style="color: #5DE4C7"> 0</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">limit</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">||</span><span style="color: #5DE4C7"> 20</span><span style="color: #A6ACCD">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #E4F0FB">client</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">zrevrangebyscore</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">args</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">results</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">          </span><span style="color: #A6ACCD">if</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">reject</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">err</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">          </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">resolve</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">results</span><span style="color: #A6ACCD">);</span></span>
<span class="line"><span style="color: #5DE4C7">        </span><span style="color: #A6ACCD">});</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">}));</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #ADD7FF">fromIndex</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">indexName</span><span style="color: #A6ACCD">)</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">_getIndexedIds</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">indexName</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #D0679D">undefined</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> 250</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #5DE4C7">      </span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">then</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">results</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">all</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">results</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">map</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">result</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=></span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7; font-style: italic">this</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">findOne</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">result</span><span style="color: #A6ACCD">))));</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>Notice that inside <code>_getIndexedIds</code> we first <code>_clearOldIndexes</code>. This is because redis does not allow us to set expiration times for entries inside of a list so I get around this by first removing all entries that are expired before actually getting a list of all the entries in the list.</p>
<p>Then it gets a list of all the ids using the <a href="">zrangebyscore</a> function. Then it converts each one into its full object using the <code>findOne</code> function that we already made.</p>
<h3 id="usage"><a aria-hidden="true" tabindex="-1" href="#usage"><a href="#usage" style="margin-right: 10px">#</a></a>Usage</h3>
<p>Now that we have our basic <code>RedisModel</code> class we can create new models by just exporting an instance with our schema. For example we could have a <code>models/log.js</code> file that looks like this:</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #767C9DB0; font-style: italic">// models/log.js</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">RedisModel</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">../lib/redis</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">logSchema</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">namespace</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">logs</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">indexes</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">[</span></span>
<span class="line"><span style="color: #ADD7FF">    </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">getName</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">()</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">createdAt</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">shouldIndex</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">()</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">addNonTenantIndex</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">()</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">getValue</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">new</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">createdAt</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">getTime</span><span style="color: #A6ACCD">(),</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #ADD7FF">  </span><span style="color: #A6ACCD">],</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">attributes</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">source</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">kind</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">string</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">user</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">kind</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">object</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">body</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">kind</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">object</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">createdAt</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">kind</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">time</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #A6ACCD">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">export default new </span><span style="color: #E4F0FBD0">RedisModel</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">schema</span><span style="color: #A6ACCD">);</span></span></code></pre>
<p>Then in other parts of our program we can do things like this:</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">Log</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">../models/log</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// Get a list of logs</span></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">logList</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">Log</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">fromIndex</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">createdAt</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// Find a specific log</span></span>
<span class="line"><span style="color: #E4F0FB">Log</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">findOne</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">123456</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// Create a new log</span></span>
<span class="line"><span style="color: #E4F0FB">Log</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">create</span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">source</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">Web</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">body</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">An error happened</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">user</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">email</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">joe@cool.com</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">createdAt</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">new</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">(),</span></span>
<span class="line"><span style="color: #A6ACCD">});</span></span></code></pre>
<p>And based on how we built it, we think about our individual objects in terms of <code>ids</code> and not keys.</p>
<h3 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><a href="#conclusion" style="margin-right: 10px">#</a></a>Conclusion</h3>
<p>You can see a <a href="https://gist.github.com/nmajor/e772d0dd166c8c3bbffb2bee00faa8a2" title="https://gist.github.com/nmajor/e772d0dd166c8c3bbffb2bee00faa8a2">gist with the full RedisModel class here</a>. Keep in mind this is mostly just to give a possible starting point. Its possible there are some bugs in here since I had to water down my implementation a bit to keep this post concise.</p>
<p>As always, please let me know if you see any issues with the code, or possible problems with my implementation or design choices. I'm always learning.</p>
<p>Thanks for reading!</p></div></div></article></div></div></div></div></div></div></main><footer class="mt-32 flex-none"><div class="sm:px-8"><div class="mx-auto w-full max-w-7xl lg:px-8"><div class="pb-16 pt-10"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200"><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/about">About</a><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/projects">Projects</a><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/speaking">Speaking</a><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/uses">Uses</a></div><p class="text-sm text-zinc-400 dark:text-zinc-500">© <!-- -->2023<!-- --> Spencer Sharp. All rights reserved.</p></div></div></div></div></div></div></footer></div></div><script src="/_next/static/chunks/webpack-113544170b8b14d7.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/9d8f288a99c54fb3.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:I[7483,[],\"\"]\n5:I[655,[],\"\"]\n6:I[2286,[\"736\",\"static/chunks/736-93d26bf9f492bada.js\",\"545\",\"static/chunks/545-972397648c423446.js\",\"871\",\"static/chunks/871-e93f475163439fcd.js\",\"185\",\"static/chunks/app/layout-58152a9375fe786b.js\"],\"ThemeProvider\"]\n7:I[7019,[\"736\",\"static/chunks/736-93d26bf9f492bada.js\",\"545\",\"static/chunks/545-972397648c423446.js\",\"871\",\"static/chunks/871-e93f475163439fcd.js\",\"185\",\"static/chunks/app/layout-58152a9375fe786b.js\"],\"Header\"]\n8:I[3849,[],\"\"]\n9:I[8656,[],\"\"]\na:I[4736,[\"736\",\"s"])</script><script>self.__next_f.push([1,"tatic/chunks/736-93d26bf9f492bada.js\",\"991\",\"static/chunks/app/posts/page-6d06c0c42f2ef9eb.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9d8f288a99c54fb3.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"ukvsT-xGIrbijjiNPJuDN\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2018-09-20-simple-object-storage-in-redis-and-node\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"2018-09-20-simple-object-storage-in-redis-and-node\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"2018-09-20-simple-object-storage-in-redis-and-node\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L4\"],\"globalErrorComponent\":\"$5\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"h-full antialiased\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"flex h-full\",\"children\":[\"$\",\"$L6\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"div\",null,{\"className\":\"flex w-full\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative flex w-full flex-col\",\"children\":[[\"$\",\"$L7\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-auto\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"sm:px-8 flex h-full items-center pt-16 sm:pt-32\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto w-full max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-base font-semibold text-zinc-400 dark:text-zinc-500\",\"children\":\"404\"}],[\"$\",\"h1\",null,{\"className\":\"mt-4 text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-5xl\",\"children\":\"Page not found\"}],[\"$\",\"p\",null,{\"className\":\"mt-4 text-base text-zinc-600 dark:text-zinc-400\",\"children\":\"Sorry, we couldn’t find the page you’re looking for.\"}],[\"$\",\"$La\",null,{\"href\":\"/\",\"children\":[\"$\",\"button\",null,{\"className\":\"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 mt-4\",\"children\":\"Go back home\"}]}]]}]}]}]}]}],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"slug\",\"2018-09-20-simple-object-storage-in-redis-and-node\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lb\",\"$Lc\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"2018-09-20-simple-object-storage-in-redis-and-node\\\"}\"},\"styles\":null}],\"segment\":[\"slug\",\"2018-09-20-simple-object-storage-in-redis-and-node\",\"d\"]},\"styles\":null}],\"segment\":\"posts\"},\"styles\":null}]}],[\"$\",\"footer\",null,{\"className\":\"mt-32 flex-none\",\"children\":[\"$\",\"div\",null,{\"className\":\"sm:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto w-full max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"pb-16 pt-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center justify-between gap-6 sm:flex-row\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200\",\"children\":[[\"$\",\"$La\",null,{\"href\":\"/about\",\"className\":\"transition hover:text-teal-500 dark:hover:text-teal-400\",\"children\":\"About\"}],[\"$\",\"$La\",null,{\"href\":\"/projects\",\"className\":\"transition hover:text-teal-500 dark:hover:text-teal-400\",\"children\":\"Projects\"}],[\"$\",\"$La\",null,{\"href\":\"/speaking\",\"className\":\"transition hover:text-teal-500 dark:hover:text-teal-400\",\"children\":\"Speaking\"}],[\"$\",\"$La\",null,{\"href\":\"/uses\",\"className\":\"transition hover:text-teal-500 dark:hover:text-teal-400\",\"children\":\"Uses\"}]]}],[\"$\",\"p\",null,{\"className\":\"text-sm text-zinc-400 dark:text-zinc-500\",\"children\":[\"© \",2023,\" Spencer Sharp. All rights reserved.\"]}]]}]}]}]}]}]}]}]]}]}]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"d:T19ae8,"])</script><script>self.__next_f.push([1,"\u003cp\u003e\u003cstrong\u003eFirst\u003c/strong\u003e it was important for our use case to have some basic kind of indexing and sorting based on when the document was created.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSecond\u003c/strong\u003e, since we do a lot of logging, we needed to make sure that all documents clean up after themselves and expire nicely so we don't run out of space in redis, and we don't really care about keeping these logs indefinitely.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eThird\u003c/strong\u003e, our logs are javascript objects, so we needed some kind of customizable serialization/deserialization.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eFourth\u003c/strong\u003e, I wanted to have a nice abstraction with predictable model-like behavior like \u003ccode\u003efindOne\u003c/code\u003e, \u003ccode\u003ecreate\u003c/code\u003e, \u003ccode\u003eupdate\u003c/code\u003e, and \u003ccode\u003efromIndex\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eSo here is a basic solution I came up with.\u003c/p\u003e\n\u003cp\u003eThe plan:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eSchema\u003c/strong\u003e - Add a schema for \u003ccode\u003eredisModels\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eFinding, Creating and Updating\u003c/strong\u003e - Use \u003ca href=\"\"\u003eredis hashes\u003c/a\u003e to store our objects and have functions for adding, finding, and updating.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eIndexing and Sorting\u003c/strong\u003e - Use \u003ca href=\"https://redis.io/topics/data-types#lists\" title=\"https://redis.io/topics/data-types#lists\"\u003eredis lists\u003c/a\u003e (aka ranges) to maintain a sorted list of object keys.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eI'll be using the main \u003ca href=\"https://www.npmjs.com/package/redis\" title=\"https://www.npmjs.com/package/redis\"\u003eredis node\u003c/a\u003e library for this.\u003c/p\u003e\n\u003ch3 id=\"schema\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#schema\"\u003e\u003ca href=\"#schema\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eSchema\u003c/h3\u003e\n\u003cp\u003eHere is what our basic schema will look like:\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003elogSchema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003enamespace\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003elogs\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eindexes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003egetName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eshouldIndex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etrue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eaddNonTenantIndex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etrue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003egetValue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eDate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003egetTime\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eattributes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003esource\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003estring\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003euser\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eobject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ebody\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eobject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etime\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e};\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs you can see we set information about our \u003ccode\u003eattributes\u003c/code\u003e, \u003ccode\u003eindexes\u003c/code\u003e and a \u003ccode\u003enamespace\u003c/code\u003e that we will use for our redis keys. The \u003ccode\u003enamespace\u003c/code\u003e is mostly useful if you plan on storing multiple kinds of objects in redis.\u003c/p\u003e\n\u003ch3 id=\"creating\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#creating\"\u003e\u003ca href=\"#creating\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eCreating\u003c/h3\u003e\n\u003cp\u003eWe'll start by creating a new class and constructor inside of a new file called \u003ccode\u003elib/redis.js\u003c/code\u003e. I know this is a bunch of code to dump in all at once, but I'll break it down afterwards:\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eimport \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eshortid\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eshortid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eimport \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e_\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003elodash\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003egetRedisClient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// IMPLEMENT YOUR OWN METHOD OF GETTING THE REDIS CLIENT,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eexpSeconds\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edays\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e30\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003esecondsPerDay\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e86400\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edays\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003esecondsPerDay\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ebuildId\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e() { \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eshortid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003egenerate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(); }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringify\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003estring\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003enumber\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoString\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003edate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eDate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoISOString\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003etime\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eDate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoISOString\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eobject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e JSON\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003estringify\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eexport default \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003eclass\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eRedisModel\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econstructor\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      schema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003egetRedisClient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e_buildHashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e schema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eattributes\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e_\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eeach\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eattributes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e]\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e||\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{}).\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringValue\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringify\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e]\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e?\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringify\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e](\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e||\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringValue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003enull\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003epush\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringValue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e_\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eisEmpty\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e?\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e_buildRedisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e`${\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003enamespace\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}`\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ecreate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e new \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e((\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ebuildId\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildRedisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// Handle the hash values\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildHashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ehmset\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ehmset\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eEX\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpSeconds\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexec\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e((\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e({\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e_id\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e...\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eelse\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eError\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eEmpty redis hash data\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFirst of all you'll notice I'm using the \u003ca href=\"\"\u003elodash\u003c/a\u003e for its useful helper methods, and \u003ca href=\"https://www.npmjs.com/package/shortid\" title=\"https://www.npmjs.com/package/shortid\"\u003eshortid\u003c/a\u003e to help generate unique ids for our redis keys.\u003c/p\u003e\n\u003cp\u003eWe are using the \u003ccode\u003emulti\u003c/code\u003e redis behavior.\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ehmset\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ehmset\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eEX\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpSeconds\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexec\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e((\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis allows us to do multiple calls in one redis transaction, and if one of the calls fails, the whole transaction will fail. This reduces the chances that we'll have stray data being stored in the database.\u003c/p\u003e\n\u003cp\u003eWe're also using our schema namespace to build a unique redis key for our object.\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildRedisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildRedisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e } \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e`${\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003enamespace\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}`\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis isn't totally necessary, and really only useful if you are storing multiple types of objects in redis, but it does give us the ability to do basic fetching redis for all items with the namespace prefix later if we want.\u003c/p\u003e\n\u003cp\u003eYou can see that we're using a \u003ca href=\"https://redis.io/topics/data-types#hashes\" title=\"https://redis.io/topics/data-types#hashes\"\u003eredis hash\u003c/a\u003e to store all our object data.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003emulti.hmset(redisKey, hashValues);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ca href=\"https://redis.io/commands/hmset\" title=\"https://redis.io/commands/hmset\"\u003ehmset\u003c/a\u003e function takes an array of key value pairs. Redis hashes require the values to be strings, so our \u003ccode\u003e_buildHashValues\u003c/code\u003e function takes our data and converts it to an array of strings based on the key/value pairs and attribute types in the schema.\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildHashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e { schema: { \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eattributes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e } } \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e [];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e_\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eeach\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, (\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e (\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eattributes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e] \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e||\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {}).\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringValue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringify\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e] \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e?\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringify\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e](\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    if (\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e||\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringValue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003enull\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003epush\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003estringValue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e_\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eisEmpty\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e?\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd it uses our \u003ccode\u003estringify\u003c/code\u003e object as a map for how to convert the different attributes to strings based on the schema. This gives us some granular control over the serialization of each attribute of our objects.\u003c/p\u003e\n\u003cp\u003eAnd we're also setting an expiration for our keys so they dont last forever in our database.\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ehmset\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eEX\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpSeconds\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e());\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd that handles our ability to create new objects in our redis model.\u003c/p\u003e\n\u003ch3 id=\"updating\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#updating\"\u003e\u003ca href=\"#updating\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eUpdating\u003c/h3\u003e\n\u003cp\u003eOur update function is very similar to our create:\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eexport default \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003eclass\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eRedisModel\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eupdate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e new \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e((\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildRedisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// Handle the hash values\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildHashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ehmset\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eelse\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBasically it uses the same \u003ccode\u003e_buildRedisKey\u003c/code\u003e function so we only have to deal with the id of the object. Then it basically just does the same \u003ccode\u003ehmset\u003c/code\u003e function. Redis will keep any attributes in the hash that are not overwritten.\u003c/p\u003e\n\u003ch3 id=\"finding\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#finding\"\u003e\u003ca href=\"#finding\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFinding\u003c/h3\u003e\n\u003cp\u003eHere's our find method. This lets us find any object by id and deserialize all the values into their original datatypes based on the schema:\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eparsify\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003estring\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003enumber\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eparseInt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e10\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003edate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eDate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003etime\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eDate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eobject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e JSON\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eparse\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eexport default \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003eclass\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eRedisModel\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e_unpackHashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e schema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eattributes\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eobj\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e_\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eeach\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eattributes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e]\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e||\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{}).\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003enull\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eobj\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e]\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eparsify\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e](\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003enull\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e_\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eisEmpty\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eobj\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e?\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eobj\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003efindOne\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e new \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e((\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildRedisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ehgetall\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e_id\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e...\u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_unpackHashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere is where we use a \u003ccode\u003eparsify\u003c/code\u003e method to convert our attribute strings into their original data type.\u003c/p\u003e\n\u003cp\u003eAnd that handles our finding and deserialization.\u003c/p\u003e\n\u003ch3 id=\"indexing-and-sorting\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#indexing-and-sorting\"\u003e\u003ca href=\"#indexing-and-sorting\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eIndexing and Sorting\u003c/h3\u003e\n\u003cp\u003eHere is the tricky part. Redis, as a key/value store doesnt have any real sense of ordering when it comes to its keys. But its important for our use case to be able to see the most recent logs, and maybe later be able to query date ranges of when the logs were created.\u003c/p\u003e\n\u003cp\u003eSo what we're going to do is use the redis function \u003ccode\u003ezadd\u003c/code\u003e to add the redis key and timestamp for each object into a sorted redis list.\u003c/p\u003e\n\u003cp\u003eRemember from our schema, indexes look like this:\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003egetName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003eshouldIndex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etrue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003egetValue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eDate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003egetTime\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003egetName\u003c/code\u003e is a function because I've found it useful to be able to create some indexes that are isolated in different ways. For example I've sometimes added indexes that are based on the ID of the user who created the log, this lets me easily get a list of all the user's most recent indexes. And in that case the \u003ccode\u003egetName\u003c/code\u003e looks like this \u003ccode\u003egetName: data =\u003e ('user:'+data.user._id+':createdAt')\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eshouldIndex\u003c/code\u003e lets us not index any object we want, and \u003ccode\u003egetValue\u003c/code\u003e gives us the actual value of the index, so this actually lets us create sorted lists using any different attribute not just createdAt. Just remember that \u003ccode\u003egetValue\u003c/code\u003e has to return a number.\u003c/p\u003e\n\u003cp\u003eNow we modify our \u003ccode\u003ecreate\u003c/code\u003e function to include a \u003ccode\u003ezadd\u003c/code\u003e for each index in our schema:\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildIndexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e } \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e`${\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003enamespace\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}`\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ecreate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e } \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e((\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ebuildId\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildRedisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// Handle the hash values\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildHashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      if (\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ehmset\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ehashValues\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ehmset\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eEX\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpSeconds\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// Handle indexes\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        if (\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e_\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eeach\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, (\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e            if (\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eshouldIndex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e              \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ezadd\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildIndexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003egetName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)), \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003egetValue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e), \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e          });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emulti\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexec\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e((\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e          if (\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e({\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eredisKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e_id\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e...\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      } else {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eError\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eEmpty redis hash data\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis inserts the \u003ccode\u003eredisKey\u003c/code\u003e of each object into a sorted list based on the createdAt timestamp of the object.\u003c/p\u003e\n\u003cp\u003eNow we can easily retrieve the top objects from any index with a function like this:\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eexport default \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003eclass\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eRedisModel\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e_clearOldIndexes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e new \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e((\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003enow\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e new \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eDate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e().\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003egetTime\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003esecondsPerDay\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e 86400\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eargs\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_buildIndexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003enow\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e+\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpSeconds\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003esecondsPerDay\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e 1000\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e-inf\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ezremrangebyscore\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eargs\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresults\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresults\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e_getIndexedIds\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eoffset\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003elimit\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprops\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_clearOldIndexes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ethen\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(()\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e new \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e((\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eargs\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e+inf\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e-inf\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eLIMIT\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eoffset\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e||\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e 0\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003elimit\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e||\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e 20\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eclient\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ezrevrangebyscore\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eargs\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresults\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ereject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresults\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003efromIndex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003e_getIndexedIds\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eindexName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e 250\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ethen\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresults\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eall\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresults\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003emap\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresult\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7; font-style: italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003efindOne\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresult\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e))));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNotice that inside \u003ccode\u003e_getIndexedIds\u003c/code\u003e we first \u003ccode\u003e_clearOldIndexes\u003c/code\u003e. This is because redis does not allow us to set expiration times for entries inside of a list so I get around this by first removing all entries that are expired before actually getting a list of all the entries in the list.\u003c/p\u003e\n\u003cp\u003eThen it gets a list of all the ids using the \u003ca href=\"\"\u003ezrangebyscore\u003c/a\u003e function. Then it converts each one into its full object using the \u003ccode\u003efindOne\u003c/code\u003e function that we already made.\u003c/p\u003e\n\u003ch3 id=\"usage\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#usage\"\u003e\u003ca href=\"#usage\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eUsage\u003c/h3\u003e\n\u003cp\u003eNow that we have our basic \u003ccode\u003eRedisModel\u003c/code\u003e class we can create new models by just exporting an instance with our schema. For example we could have a \u003ccode\u003emodels/log.js\u003c/code\u003e file that looks like this:\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// models/log.js\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eimport \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eRedisModel\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e../lib/redis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003elogSchema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003enamespace\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003elogs\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eindexes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003egetName\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eshouldIndex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etrue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eaddNonTenantIndex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etrue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003egetValue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eDate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003egetTime\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eattributes\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003esource\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003estring\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003euser\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eobject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ebody\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eobject\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ekind\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etime\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eexport default new \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eRedisModel\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eschema\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen in other parts of our program we can do things like this:\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eimport \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eLog\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e../models/log\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// Get a list of logs\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003elogList\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eLog\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003efromIndex\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// Find a specific log\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003eLog\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003efindOne\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e123456\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// Create a new log\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003eLog\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003ecreate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003esource\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eWeb\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ebody\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eAn error happened\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003euser\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eemail\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ejoe@cool.com\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eDate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e});\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd based on how we built it, we think about our individual objects in terms of \u003ccode\u003eids\u003c/code\u003e and not keys.\u003c/p\u003e\n\u003ch3 id=\"conclusion\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#conclusion\"\u003e\u003ca href=\"#conclusion\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eConclusion\u003c/h3\u003e\n\u003cp\u003eYou can see a \u003ca href=\"https://gist.github.com/nmajor/e772d0dd166c8c3bbffb2bee00faa8a2\" title=\"https://gist.github.com/nmajor/e772d0dd166c8c3bbffb2bee00faa8a2\"\u003egist with the full RedisModel class here\u003c/a\u003e. Keep in mind this is mostly just to give a possible starting point. Its possible there are some bugs in here since I had to water down my implementation a bit to keep this post concise.\u003c/p\u003e\n\u003cp\u003eAs always, please let me know if you see any issues with the code, or possible problems with my implementation or design choices. I'm always learning.\u003c/p\u003e\n\u003cp\u003eThanks for reading!\u003c/p\u003e"])</script><script>self.__next_f.push([1,"c:[\"$\",\"div\",null,{\"className\":\"sm:px-8 post mt-16 lg:mt-32\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto w-full max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"xl:relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl\",\"children\":[\"$\",\"article\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"flex flex-col\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold font-bold tracking-tight sm:text-5xl\",\"children\":\"Simple Object Storage in Redis (Node.js)\"}],[\"$\",\"div\",null,{\"className\":\"flex gap-3 pt-1\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2018-10-05\",\"className\":\"text-muted-foreground order-first flex items-center pr-2 text-base\",\"children\":[[\"$\",\"span\",null,{\"className\":\"h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500\"}],[\"$\",\"span\",null,{\"className\":\"ml-3\",\"children\":\"October 5, 2018\"}]]}],[\"$\",\"span\",null,{\"className\":\"text-muted-foreground\",\"children\":\"-\"}],[[\"$\",\"span\",\"node\",{\"className\":\"text-muted-foreground/80\",\"children\":\"node\"}],[\"$\",\"span\",\"redis\",{\"className\":\"text-muted-foreground/80\",\"children\":\"redis\"}],[\"$\",\"span\",\"javascript\",{\"className\":\"text-muted-foreground/80\",\"children\":\"javascript\"}]]]}],[\"$\",\"div\",null,{\"className\":\"text-accent-foreground pt-3 text-sm italic\",\"children\":[\"~\",\"10 min read\"]}]]}],[\"$\",\"div\",null,{\"className\":\"mt-8 prose dark:prose-invert\",\"data-mdx-content\":true,\"children\":[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$d\"}}]}]]}]}]}]}]}]}]}]\n"])</script><script>self.__next_f.push([1,"4:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Simple Object Storage in Redis (Node.js) - Spencer Sharp\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"I’m Spencer, a software designer and entrepreneur based in New York City. I’m the founder and CEO of Planetaria, where we develop technologies that empower regular people to explore space on their own terms.\"}],[\"$\",\"link\",\"4\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"undefined/feed.xml\"}]]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>