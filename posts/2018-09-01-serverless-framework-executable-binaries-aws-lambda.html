<!DOCTYPE html><html lang="en" class="h-full antialiased"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" imageSrcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=16&amp;q=75 16w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=32&amp;q=75 32w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=48&amp;q=75 48w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=64&amp;q=75 64w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=96&amp;q=75 96w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=128&amp;q=75 128w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=256&amp;q=75 256w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=384&amp;q=75 384w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=640&amp;q=75 640w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=750&amp;q=75 750w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=828&amp;q=75 828w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=3840&amp;q=75 3840w" imageSizes="2.25rem" fetchPriority="high"/><link rel="stylesheet" href="/_next/static/css/9d8f288a99c54fb3.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-113544170b8b14d7.js" crossorigin=""/><script src="/_next/static/chunks/de8a8aed-ff24f23ca546a20c.js" async="" crossorigin=""></script><script src="/_next/static/chunks/362-edde6a9467fb7f3f.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-dca2b37e6b098eb8.js" async="" crossorigin=""></script><script src="/_next/static/chunks/736-93d26bf9f492bada.js" async=""></script><script src="/_next/static/chunks/545-972397648c423446.js" async=""></script><script src="/_next/static/chunks/871-e93f475163439fcd.js" async=""></script><script src="/_next/static/chunks/app/layout-58152a9375fe786b.js" async=""></script><script src="/_next/static/chunks/app/posts/page-6d06c0c42f2ef9eb.js" async=""></script><title>Executable Binary Files with Serverless Framework and Webpack - AWS Lambda - Spencer Sharp</title><meta name="description" content="I’m Spencer, a software designer and entrepreneur based in New York City. I’m the founder and CEO of Planetaria, where we develop technologies that empower regular people to explore space on their own terms."/><link rel="alternate" type="application/rss+xml" href="undefined/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="flex h-full"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex w-full"><div class="relative flex w-full flex-col"><header class="pointer-events-none relative z-50 flex flex-none flex-col" style="height:var(--header-height);margin-bottom:var(--header-mb)"><div class="top-0 z-10 h-16 pt-6" style="position:var(--header-position)"><div class="sm:px-8 top-[var(--header-top,theme(spacing.6))] w-full" style="position:var(--header-inner-position)"><div class="mx-auto w-full max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="relative flex gap-4"><div class="flex flex-1"><div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10"><a aria-label="Home" class="pointer-events-auto" href="/"><img alt="" fetchPriority="high" width="1000" height="1000" decoding="async" data-nimg="1" class="rounded-full bg-zinc-100 object-cover dark:bg-zinc-800 h-9 w-9" style="color:transparent" sizes="2.25rem" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=16&amp;q=75 16w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=32&amp;q=75 32w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=48&amp;q=75 48w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=64&amp;q=75 64w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=96&amp;q=75 96w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=128&amp;q=75 128w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=256&amp;q=75 256w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=384&amp;q=75 384w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=640&amp;q=75 640w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=750&amp;q=75 750w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=828&amp;q=75 828w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Favatar.6206df77.jpg&amp;w=3840&amp;q=75"/></a></div></div><div class="flex flex-1 justify-end md:justify-center"><nav class="pointer-events-auto hidden md:block"><ul class="flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10"><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/about">About</a></li><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/posts">Blog</a></li><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/projects">Projects</a></li></ul></nav></div><div class="flex justify-end md:flex-1"><div class="pointer-events-auto"><button class="inline-flex items-center justify-center text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground rounded-md h-8 w-8 px-0" type="button" id="radix-:R75la:" aria-haspopup="menu" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"><circle cx="12" cy="12" r="4"></circle><path d="M12 3v1"></path><path d="M12 20v1"></path><path d="M3 12h1"></path><path d="M20 12h1"></path><path d="m18.364 5.636-.707.707"></path><path d="m6.343 17.657-.707.707"></path><path d="m5.636 5.636.707.707"></path><path d="m17.657 17.657.707.707"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg><span class="sr-only">Toggle theme</span></button></div></div></div></div></div></div></div></div></header><main class="flex-auto"><div class="sm:px-8 post mt-16 lg:mt-32"><div class="mx-auto w-full max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="xl:relative"><div class="mx-auto max-w-2xl"><article><header class="flex flex-col"><h1 class="text-4xl font-bold font-bold tracking-tight sm:text-5xl">Executable Binary Files with Serverless Framework and Webpack - AWS Lambda</h1><div class="flex gap-3 pt-1"><time dateTime="2018-09-01" class="text-muted-foreground order-first flex items-center pr-2 text-base"><span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span><span class="ml-3">September 1, 2018</span></time><span class="text-muted-foreground">-</span><span class="text-muted-foreground/80">serverless</span><span class="text-muted-foreground/80">javascript</span><span class="text-muted-foreground/80">aws</span><span class="text-muted-foreground/80">webpack</span></div><div class="text-accent-foreground pt-3 text-sm italic">~<!-- -->4 min read</div></header><div class="mt-8 prose dark:prose-invert" data-mdx-content="true"><div><h3 id="the-approach"><a aria-hidden="true" tabindex="-1" href="#the-approach"><a href="#the-approach" style="margin-right: 10px">#</a></a>The Approach</h3>
<p>Basically we need to:</p>
<ul>
<li>Upload the executable binaries with the aws lambda deployment package.</li>
<li>Make sure our executable binaries maintain the correct executable permissions.</li>
<li>Change the <code>$PATH</code> env variable to include the location of our executables.</li>
</ul>
<p>And then we should be good to go.</p>
<h3 id="upload"><a aria-hidden="true" tabindex="-1" href="#upload"><a href="#upload" style="margin-right: 10px">#</a></a>Upload</h3>
<h5 id="without-webpack"><a aria-hidden="true" tabindex="-1" href="#without-webpack"><a href="#without-webpack" style="margin-right: 10px">#</a></a>Without Webpack</h5>
<p>If you're not using the <code>serverless-webpack</code> plugin, then this is actually pretty easy.</p>
<p>I like to just create a folder in my project called <code>bin</code> and put them all in there. I did this in my <a href="http://nmajor.com/posts/serverless-back-end-for-react-your-introduction-to-serverless-architecture" title="http://nmajor.com/posts/serverless-back-end-for-react-your-introduction-to-serverless-architecture">Serverless Backend for React</a> post.</p>
<p>After you put the executables in the <code>bin</code> folder, put this in your <code>serverless.yml</code> file:</p>
<pre><code>package:
  include:
    - bin/*
</code></pre>
<p>Your files should maintain their permissions.</p>
<h5 id="with-webpack"><a aria-hidden="true" tabindex="-1" href="#with-webpack"><a href="#with-webpack" style="margin-right: 10px">#</a></a>With Webpack:</h5>
<p>Here is where it gets tricky. The package includes are not honored by the <code>serverless-webpack</code> plugin, so we have have webpack include the files in our bundle. We're going to use the official <a href="https://webpack.js.org/plugins/copy-webpack-plugin/" title="https://webpack.js.org/plugins/copy-webpack-plugin/">copy-webpack-plugin</a> to do this, but here's the kicker. The <a href="https://webpack.js.org/plugins/copy-webpack-plugin/" title="https://webpack.js.org/plugins/copy-webpack-plugin/">copy-webpack-plugin</a> does NOT preserve file permission, so we then have to write a custom plugin to set the file permissions of all the files in our <code>bin</code> folder to <code>755</code> so they can be executed by lambda.</p>
<p>But first lets copy our files with <a href="https://webpack.js.org/plugins/copy-webpack-plugin/" title="https://webpack.js.org/plugins/copy-webpack-plugin/">copy-webpack-plugin</a>. Do do this you can checkout the <a href="">documentation here</a>, or you can add this to your webpack config:</p>
<pre><code>  plugins: [
    new CopyWebpackPlugin([{
      from: 'bin/',
      to: 'bin/'
    }]),
  ]
</code></pre>
<p>Pretty easy.</p>
<h3 id="permissions"><a aria-hidden="true" tabindex="-1" href="#permissions"><a href="#permissions" style="margin-right: 10px">#</a></a>Permissions</h3>
<p>I did find a plugin called <a href="https://www.npmjs.com/package/webpack-permissions-plugin" title="https://www.npmjs.com/package/webpack-permissions-plugin">webpack-permissions-plugin </a> that helped me solve the issue with the permissions, but I couldn't get the feature to change all the permissions in the directory to work. So I decided to make my own simplified version of that plugin to simply handle changing the permissions of the files in the bin folder.</p>
<p>So here's the simple plugin I whipped up:</p>
<pre><code>const fs = require('fs');

function WebpackBinPermission(options) {
  this.options = options || {};
}

WebpackBinPermission.prototype.apply = function (compiler) {
  compiler.plugin('done', () => {
    const permissions = this.options.permissions || '755';
    const binPath = `${compiler.outputPath}/bin`;
    fs.readdir(binPath, (err, items) => {
      if (items &#x26;&#x26; items.length > 0) {
        for (let i = 0; i &#x3C; items.length; i += 1) {
          fs.chmodSync(`${binPath}/${items[i]}`, permissions);
        }
      }
    });
  });
};

module.exports = WebpackBinPermission;
</code></pre>
<p>As you can see, its pretty simple and all it does it changes the permissions of everything in the <code>/bin</code> folder to <code>755</code>. And for me it works like a charm.</p>
<p>Put that plugin code in a new file called <code>webpack-bin-permissions.js</code>.Then at the top of your webpack config file, import it like this:</p>
<pre><code>const WebpackBinPermission = require('webpack-bin-permissions')
</code></pre>
<p>To then to use it, you just have to pair it with the <a href="https://webpack.js.org/plugins/copy-webpack-plugin/" title="https://webpack.js.org/plugins/copy-webpack-plugin/">copy-webpack-plugin</a> in your webpack config like this:</p>
<pre><code>  plugins: [
    new CopyWebpackPlugin([{
      from: 'bin/',
      to: 'bin/'
    }]),
    new WebpackBinPermission(),
  ]
</code></pre>
<p>And then when <a href="">serverless-webpack</a> builds it will automatically copy everything in the bin folder and set the executable permissions correctly.</p>
<h3 id="executable-path"><a aria-hidden="true" tabindex="-1" href="#executable-path"><a href="#executable-path" style="margin-right: 10px">#</a></a>Executable Path</h3>
<p>According to the <a href="https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html" title="https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html">aws lambda documentation</a>, lambda functions run in a linux environment. And libraries are used to having access to ready to run executables. That means that in a terminal you can just type in the name of the program without referencing the whole path. If you're not familiar with how this works take a look at <a href="http://www.linfo.org/path_env_var.html" title="http://www.linfo.org/path_env_var.html">this page by linfo.org</a>.</p>
<p>To make an executable ready-to-run without referencing its path, we have to set the <code>$PATH</code> environmental variable and tell linux to look inside our own <code>bin</code> folder when searching for valid ready-to-run executables.</p>
<p>Thats actually really easy. According to <a href="">this official aws post</a> we can do it by just putting this line at the top of our handler code:</p>
<pre><code>process.env.PATH = `${process.env.PATH}:${process.env.LAMBDA_TASK_ROOT}/bin`;
</code></pre>
<p>But I like to also wrap it around some logic so it doesnt interfere with testing:</p>
<pre><code>if (process.env.LAMBDA_TASK_ROOT) {
  process.env.PATH = `${process.env.PATH}:${process.env.LAMBDA_TASK_ROOT}/bin`;
}
</code></pre>
<h3 id="wrap-it-up"><a aria-hidden="true" tabindex="-1" href="#wrap-it-up"><a href="#wrap-it-up" style="margin-right: 10px">#</a></a>Wrap it up</h3>
<p>That is the approach that worked for me. I'm currently doing a lot of stuff with executables, and so I needed a solution that allowed me to possibly put many many files in the bin folder that reference each other, and this approach seems to work well.</p>
<p>As always, please comment below if you see any room for improvement in my code, approach, or writing.</p>
<p>Thanks for reading!</p></div></div></article></div></div></div></div></div></div></main><footer class="mt-32 flex-none"><div class="sm:px-8"><div class="mx-auto w-full max-w-7xl lg:px-8"><div class="pb-16 pt-10"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200"><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/about">About</a><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/projects">Projects</a><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/speaking">Speaking</a><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/uses">Uses</a></div><p class="text-sm text-zinc-400 dark:text-zinc-500">© <!-- -->2023<!-- --> Spencer Sharp. All rights reserved.</p></div></div></div></div></div></div></footer></div></div><script src="/_next/static/chunks/webpack-113544170b8b14d7.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/9d8f288a99c54fb3.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:I[7483,[],\"\"]\n5:I[655,[],\"\"]\n6:I[2286,[\"736\",\"static/chunks/736-93d26bf9f492bada.js\",\"545\",\"static/chunks/545-972397648c423446.js\",\"871\",\"static/chunks/871-e93f475163439fcd.js\",\"185\",\"static/chunks/app/layout-58152a9375fe786b.js\"],\"ThemeProvider\"]\n7:I[7019,[\"736\",\"static/chunks/736-93d26bf9f492bada.js\",\"545\",\"static/chunks/545-972397648c423446.js\",\"871\",\"static/chunks/871-e93f475163439fcd.js\",\"185\",\"static/chunks/app/layout-58152a9375fe786b.js\"],\"Header\"]\n8:I[3849,[],\"\"]\n9:I[8656,[],\"\"]\na:I[4736,[\"736\",\"s"])</script><script>self.__next_f.push([1,"tatic/chunks/736-93d26bf9f492bada.js\",\"991\",\"static/chunks/app/posts/page-6d06c0c42f2ef9eb.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9d8f288a99c54fb3.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"AzO8YmqLI-jVS4hv3vlbF\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2018-09-01-serverless-framework-executable-binaries-aws-lambda\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"2018-09-01-serverless-framework-executable-binaries-aws-lambda\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"2018-09-01-serverless-framework-executable-binaries-aws-lambda\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L4\"],\"globalErrorComponent\":\"$5\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"h-full antialiased\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"flex h-full\",\"children\":[\"$\",\"$L6\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"div\",null,{\"className\":\"flex w-full\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative flex w-full flex-col\",\"children\":[[\"$\",\"$L7\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-auto\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"sm:px-8 flex h-full items-center pt-16 sm:pt-32\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto w-full max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-base font-semibold text-zinc-400 dark:text-zinc-500\",\"children\":\"404\"}],[\"$\",\"h1\",null,{\"className\":\"mt-4 text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-5xl\",\"children\":\"Page not found\"}],[\"$\",\"p\",null,{\"className\":\"mt-4 text-base text-zinc-600 dark:text-zinc-400\",\"children\":\"Sorry, we couldn’t find the page you’re looking for.\"}],[\"$\",\"$La\",null,{\"href\":\"/\",\"children\":[\"$\",\"button\",null,{\"className\":\"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 mt-4\",\"children\":\"Go back home\"}]}]]}]}]}]}]}],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"slug\",\"2018-09-01-serverless-framework-executable-binaries-aws-lambda\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lb\",\"$Lc\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"2018-09-01-serverless-framework-executable-binaries-aws-lambda\\\"}\"},\"styles\":null}],\"segment\":[\"slug\",\"2018-09-01-serverless-framework-executable-binaries-aws-lambda\",\"d\"]},\"styles\":null}],\"segment\":\"posts\"},\"styles\":null}]}],[\"$\",\"footer\",null,{\"className\":\"mt-32 flex-none\",\"children\":[\"$\",\"div\",null,{\"className\":\"sm:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto w-full max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"pb-16 pt-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center justify-between gap-6 sm:flex-row\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200\",\"children\":[[\"$\",\"$La\",null,{\"href\":\"/about\",\"className\":\"transition hover:text-teal-500 dark:hover:text-teal-400\",\"children\":\"About\"}],[\"$\",\"$La\",null,{\"href\":\"/projects\",\"className\":\"transition hover:text-teal-500 dark:hover:text-teal-400\",\"children\":\"Projects\"}],[\"$\",\"$La\",null,{\"href\":\"/speaking\",\"className\":\"transition hover:text-teal-500 dark:hover:text-teal-400\",\"children\":\"Speaking\"}],[\"$\",\"$La\",null,{\"href\":\"/uses\",\"className\":\"transition hover:text-teal-500 dark:hover:text-teal-400\",\"children\":\"Uses\"}]]}],[\"$\",\"p\",null,{\"className\":\"text-sm text-zinc-400 dark:text-zinc-500\",\"children\":[\"© \",2023,\" Spencer Sharp. All rights reserved.\"]}]]}]}]}]}]}]}]}]]}]}]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"d:T1c31,"])</script><script>self.__next_f.push([1,"\u003ch3 id=\"the-approach\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-approach\"\u003e\u003ca href=\"#the-approach\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eThe Approach\u003c/h3\u003e\n\u003cp\u003eBasically we need to:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUpload the executable binaries with the aws lambda deployment package.\u003c/li\u003e\n\u003cli\u003eMake sure our executable binaries maintain the correct executable permissions.\u003c/li\u003e\n\u003cli\u003eChange the \u003ccode\u003e$PATH\u003c/code\u003e env variable to include the location of our executables.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAnd then we should be good to go.\u003c/p\u003e\n\u003ch3 id=\"upload\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#upload\"\u003e\u003ca href=\"#upload\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eUpload\u003c/h3\u003e\n\u003ch5 id=\"without-webpack\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#without-webpack\"\u003e\u003ca href=\"#without-webpack\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eWithout Webpack\u003c/h5\u003e\n\u003cp\u003eIf you're not using the \u003ccode\u003eserverless-webpack\u003c/code\u003e plugin, then this is actually pretty easy.\u003c/p\u003e\n\u003cp\u003eI like to just create a folder in my project called \u003ccode\u003ebin\u003c/code\u003e and put them all in there. I did this in my \u003ca href=\"http://nmajor.com/posts/serverless-back-end-for-react-your-introduction-to-serverless-architecture\" title=\"http://nmajor.com/posts/serverless-back-end-for-react-your-introduction-to-serverless-architecture\"\u003eServerless Backend for React\u003c/a\u003e post.\u003c/p\u003e\n\u003cp\u003eAfter you put the executables in the \u003ccode\u003ebin\u003c/code\u003e folder, put this in your \u003ccode\u003eserverless.yml\u003c/code\u003e file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003epackage:\n  include:\n    - bin/*\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYour files should maintain their permissions.\u003c/p\u003e\n\u003ch5 id=\"with-webpack\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#with-webpack\"\u003e\u003ca href=\"#with-webpack\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eWith Webpack:\u003c/h5\u003e\n\u003cp\u003eHere is where it gets tricky. The package includes are not honored by the \u003ccode\u003eserverless-webpack\u003c/code\u003e plugin, so we have have webpack include the files in our bundle. We're going to use the official \u003ca href=\"https://webpack.js.org/plugins/copy-webpack-plugin/\" title=\"https://webpack.js.org/plugins/copy-webpack-plugin/\"\u003ecopy-webpack-plugin\u003c/a\u003e to do this, but here's the kicker. The \u003ca href=\"https://webpack.js.org/plugins/copy-webpack-plugin/\" title=\"https://webpack.js.org/plugins/copy-webpack-plugin/\"\u003ecopy-webpack-plugin\u003c/a\u003e does NOT preserve file permission, so we then have to write a custom plugin to set the file permissions of all the files in our \u003ccode\u003ebin\u003c/code\u003e folder to \u003ccode\u003e755\u003c/code\u003e so they can be executed by lambda.\u003c/p\u003e\n\u003cp\u003eBut first lets copy our files with \u003ca href=\"https://webpack.js.org/plugins/copy-webpack-plugin/\" title=\"https://webpack.js.org/plugins/copy-webpack-plugin/\"\u003ecopy-webpack-plugin\u003c/a\u003e. Do do this you can checkout the \u003ca href=\"\"\u003edocumentation here\u003c/a\u003e, or you can add this to your webpack config:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e  plugins: [\n    new CopyWebpackPlugin([{\n      from: 'bin/',\n      to: 'bin/'\n    }]),\n  ]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePretty easy.\u003c/p\u003e\n\u003ch3 id=\"permissions\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#permissions\"\u003e\u003ca href=\"#permissions\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003ePermissions\u003c/h3\u003e\n\u003cp\u003eI did find a plugin called \u003ca href=\"https://www.npmjs.com/package/webpack-permissions-plugin\" title=\"https://www.npmjs.com/package/webpack-permissions-plugin\"\u003ewebpack-permissions-plugin \u003c/a\u003e that helped me solve the issue with the permissions, but I couldn't get the feature to change all the permissions in the directory to work. So I decided to make my own simplified version of that plugin to simply handle changing the permissions of the files in the bin folder.\u003c/p\u003e\n\u003cp\u003eSo here's the simple plugin I whipped up:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econst fs = require('fs');\n\nfunction WebpackBinPermission(options) {\n  this.options = options || {};\n}\n\nWebpackBinPermission.prototype.apply = function (compiler) {\n  compiler.plugin('done', () =\u003e {\n    const permissions = this.options.permissions || '755';\n    const binPath = `${compiler.outputPath}/bin`;\n    fs.readdir(binPath, (err, items) =\u003e {\n      if (items \u0026#x26;\u0026#x26; items.length \u003e 0) {\n        for (let i = 0; i \u0026#x3C; items.length; i += 1) {\n          fs.chmodSync(`${binPath}/${items[i]}`, permissions);\n        }\n      }\n    });\n  });\n};\n\nmodule.exports = WebpackBinPermission;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs you can see, its pretty simple and all it does it changes the permissions of everything in the \u003ccode\u003e/bin\u003c/code\u003e folder to \u003ccode\u003e755\u003c/code\u003e. And for me it works like a charm.\u003c/p\u003e\n\u003cp\u003ePut that plugin code in a new file called \u003ccode\u003ewebpack-bin-permissions.js\u003c/code\u003e.Then at the top of your webpack config file, import it like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econst WebpackBinPermission = require('webpack-bin-permissions')\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo then to use it, you just have to pair it with the \u003ca href=\"https://webpack.js.org/plugins/copy-webpack-plugin/\" title=\"https://webpack.js.org/plugins/copy-webpack-plugin/\"\u003ecopy-webpack-plugin\u003c/a\u003e in your webpack config like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e  plugins: [\n    new CopyWebpackPlugin([{\n      from: 'bin/',\n      to: 'bin/'\n    }]),\n    new WebpackBinPermission(),\n  ]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd then when \u003ca href=\"\"\u003eserverless-webpack\u003c/a\u003e builds it will automatically copy everything in the bin folder and set the executable permissions correctly.\u003c/p\u003e\n\u003ch3 id=\"executable-path\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#executable-path\"\u003e\u003ca href=\"#executable-path\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eExecutable Path\u003c/h3\u003e\n\u003cp\u003eAccording to the \u003ca href=\"https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html\" title=\"https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html\"\u003eaws lambda documentation\u003c/a\u003e, lambda functions run in a linux environment. And libraries are used to having access to ready to run executables. That means that in a terminal you can just type in the name of the program without referencing the whole path. If you're not familiar with how this works take a look at \u003ca href=\"http://www.linfo.org/path_env_var.html\" title=\"http://www.linfo.org/path_env_var.html\"\u003ethis page by linfo.org\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eTo make an executable ready-to-run without referencing its path, we have to set the \u003ccode\u003e$PATH\u003c/code\u003e environmental variable and tell linux to look inside our own \u003ccode\u003ebin\u003c/code\u003e folder when searching for valid ready-to-run executables.\u003c/p\u003e\n\u003cp\u003eThats actually really easy. According to \u003ca href=\"\"\u003ethis official aws post\u003c/a\u003e we can do it by just putting this line at the top of our handler code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eprocess.env.PATH = `${process.env.PATH}:${process.env.LAMBDA_TASK_ROOT}/bin`;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBut I like to also wrap it around some logic so it doesnt interfere with testing:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eif (process.env.LAMBDA_TASK_ROOT) {\n  process.env.PATH = `${process.env.PATH}:${process.env.LAMBDA_TASK_ROOT}/bin`;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"wrap-it-up\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#wrap-it-up\"\u003e\u003ca href=\"#wrap-it-up\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eWrap it up\u003c/h3\u003e\n\u003cp\u003eThat is the approach that worked for me. I'm currently doing a lot of stuff with executables, and so I needed a solution that allowed me to possibly put many many files in the bin folder that reference each other, and this approach seems to work well.\u003c/p\u003e\n\u003cp\u003eAs always, please comment below if you see any room for improvement in my code, approach, or writing.\u003c/p\u003e\n\u003cp\u003eThanks for reading!\u003c/p\u003e"])</script><script>self.__next_f.push([1,"c:[\"$\",\"div\",null,{\"className\":\"sm:px-8 post mt-16 lg:mt-32\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto w-full max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"xl:relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl\",\"children\":[\"$\",\"article\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"flex flex-col\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold font-bold tracking-tight sm:text-5xl\",\"children\":\"Executable Binary Files with Serverless Framework and Webpack - AWS Lambda\"}],[\"$\",\"div\",null,{\"className\":\"flex gap-3 pt-1\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2018-09-01\",\"className\":\"text-muted-foreground order-first flex items-center pr-2 text-base\",\"children\":[[\"$\",\"span\",null,{\"className\":\"h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500\"}],[\"$\",\"span\",null,{\"className\":\"ml-3\",\"children\":\"September 1, 2018\"}]]}],[\"$\",\"span\",null,{\"className\":\"text-muted-foreground\",\"children\":\"-\"}],[[\"$\",\"span\",\"serverless\",{\"className\":\"text-muted-foreground/80\",\"children\":\"serverless\"}],[\"$\",\"span\",\"javascript\",{\"className\":\"text-muted-foreground/80\",\"children\":\"javascript\"}],[\"$\",\"span\",\"aws\",{\"className\":\"text-muted-foreground/80\",\"children\":\"aws\"}],[\"$\",\"span\",\"webpack\",{\"className\":\"text-muted-foreground/80\",\"children\":\"webpack\"}]]]}],[\"$\",\"div\",null,{\"className\":\"text-accent-foreground pt-3 text-sm italic\",\"children\":[\"~\",\"4 min read\"]}]]}],[\"$\",\"div\",null,{\"className\":\"mt-8 prose dark:prose-invert\",\"data-mdx-content\":true,\"children\":[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$d\"}}]}]]}]}]}]}]}]}]}]\n"])</script><script>self.__next_f.push([1,"4:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Executable Binary Files with Serverless Framework and Webpack - AWS Lambda - Spencer Sharp\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"I’m Spencer, a software designer and entrepreneur based in New York City. I’m the founder and CEO of Planetaria, where we develop technologies that empower regular people to explore space on their own terms.\"}],[\"$\",\"link\",\"4\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"undefined/feed.xml\"}]]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>